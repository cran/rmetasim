<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="A Strand" />

<meta name="date" content="2018-01-03" />

<title>Setting up simulations in rmetasim</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Setting up simulations in rmetasim</h1>
<h4 class="author"><em>A Strand</em></h4>
<h4 class="date"><em>2018-01-03</em></h4>



<div id="more-on-simulating-landscapes" class="section level1">
<h1>More on simulating landscapes</h1>
<p>The philosophy of rmetasim is to provide flexible and powerful ways to simulate realistic demography underlying population genetics. Usually when a software author uses the words <code>flexible'' and</code>powerful’‘, it usually means ``hard to use’’. rmetasim has proven to be a bit impenetrable to users starting off so, empirically, this software fits into that category. This vignette is an attempt to explain some of the approaches to simulation that rmetasim can help implement, and lower the activation energy required for its use.</p>
<div id="alternatives-to-landscape.simulate" class="section level2">
<h2>Alternatives to landscape.simulate()</h2>
<p>The main simulation function,  is the typical approach to simulations in rmetasim. Each simulation step (year) is composed of several substeps:</p>
<ol style="list-style-type: decimal">
<li>choose populations for extirpation and if any, kill them off</li>
<li>reproduce</li>
<li>impose survival and growth to new stages</li>
<li>reduce populations to the carrying capacity</li>
<li>advance the year counter and return to step 1. This is repeated ‘numit’ times.</li>
</ol>
<p>These steps are implemented n C++ for speed. It is possible, however, to run each of these steps separately. This can help in debugging a landscape or implementing a simulation where survival precedes reproduction, or changing the time in which extinction occurs or just for fun.</p>
<p>Here is a simulation using landscape.simulate()</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rmetasim)
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.example</span>()
rland &lt;-<span class="st"> </span><span class="kw">landscape.simulate</span>(rland,<span class="dv">10</span>)
<span class="kw">landscape.amova</span>(rland)</code></pre></div>
<pre><code>##         Phi         Phi         Phi 
##  0.08478025 -0.00747118  0.06374813</code></pre>
<p>Here is the same simulation with the individual steps implemented in R functions (which call corresponding C++ functions)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rland &lt;-<span class="st"> </span><span class="kw">landscape.new.example</span>()
<span class="cf">for</span> (gen <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
    {
        rland &lt;-<span class="st"> </span><span class="kw">landscape.extinct</span>(rland)
        rland &lt;-<span class="st"> </span><span class="kw">landscape.reproduce</span>(rland)
        rland &lt;-<span class="st"> </span><span class="kw">landscape.survive</span>(rland)
        rland &lt;-<span class="st"> </span><span class="kw">landscape.carry</span>(rland)
        rland &lt;-<span class="st"> </span><span class="kw">landscape.advance</span>(rland)
    }
<span class="kw">landscape.amova</span>(rland)</code></pre></div>
<pre><code>##        Phi        Phi        Phi 
## 0.06889342 0.03009405 0.05359149</code></pre>
<div id="or-with-magrittr" class="section level3">
<h3>or with magrittr</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(magrittr)
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.example</span>()
<span class="cf">for</span> (gen <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
    {
        rland &lt;-<span class="st"> </span>rland <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">landscape.extinct</span>() <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">landscape.reproduce</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">            </span><span class="kw">landscape.survive</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">landscape.carry</span>()<span class="op">%&gt;%</span><span class="kw">landscape.advance</span>()
    }
<span class="kw">landscape.amova</span>(rland)</code></pre></div>
<pre><code>##        Phi        Phi        Phi 
## 0.06303234 0.07895600 0.07627561</code></pre>
<p>These approaches are a little slower because there is conversion between the R version of a landscape (a list) and the internal C++ backend representation more often.</p>
</div>
</div>
<div id="examining-temporal-dynamics" class="section level2">
<h2>Examining temporal dynamics</h2>
<p>You can see in the previous section how the same landscape can be the input and output of a simulation. You can use this with loops to examine the temporal dynamics of a simulation through time.</p>
<p>The following runs a simulation for 100 years and checks the among-population differentiation every 5 years. Finally it plots the results. This landscape has no migration among the two populations, so the among-pop differentiation should be an increasing function, with some potentially interesting patterns.</p>
<p>In general it is advisable to make the rmetasim sessions less script-like and more a set of functions. The following is a new function to create landscapes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">create.land &lt;-<span class="st"> </span><span class="cf">function</span>()
    {
### CREATE A LANDSCAPE
###first set up the matrices for local demographies
        S &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)
        R &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)
        M &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)
        
                                        <span class="co">#and epochs </span>
        S.epoch &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">36</span>), <span class="dt">nrow =</span> <span class="dv">6</span>)
        R.epoch &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">36</span>), <span class="dt">nrow =</span> <span class="dv">6</span>)
        M.epoch &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">36</span>), <span class="dt">nrow =</span> <span class="dv">6</span>)
        
        
        
        ##now create the landscape
        <span class="kw">landscape.new.empty</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">            </span><span class="kw">landscape.new.intparam</span>(<span class="dt">h=</span><span class="dv">3</span>,<span class="dt">s=</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                </span><span class="kw">landscape.new.switchparam</span>(<span class="dt">mp=</span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">                    </span><span class="kw">landscape.new.floatparam</span>() <span class="op">%&gt;%</span>
<span class="st">                        </span><span class="kw">landscape.new.local.demo</span>( S, R, M) <span class="op">%&gt;%</span>
<span class="st">                            </span><span class="kw">landscape.new.epoch</span>(<span class="dt">S =</span> S.epoch, <span class="dt">R =</span> R.epoch, <span class="dt">M =</span> M.epoch, 
                              <span class="dt">carry =</span> <span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>, <span class="dv">1000</span>)) <span class="op">%&gt;%</span>
<span class="st">                                </span><span class="kw">landscape.new.locus</span>(<span class="dt">type =</span> <span class="dv">1</span>, <span class="dt">ploidy =</span> <span class="dv">2</span>, 
                                  <span class="dt">mutationrate =</span> <span class="fl">0.001</span>, <span class="dt">transmission =</span> <span class="dv">0</span>, <span class="dt">numalleles =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span>
<span class="st">                                </span><span class="kw">landscape.new.locus</span>(<span class="dt">type =</span> <span class="dv">0</span>, <span class="dt">ploidy =</span> <span class="dv">1</span>, 
                                  <span class="dt">mutationrate =</span> <span class="fl">0.005</span>, <span class="dt">numalleles =</span> <span class="dv">3</span>, <span class="dt">frequencies =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>)) <span class="op">%&gt;%</span>
<span class="st">                                </span><span class="kw">landscape.new.locus</span>(<span class="dt">type =</span> <span class="dv">2</span>, <span class="dt">ploidy =</span> <span class="dv">1</span>, 
                                  <span class="dt">mutationrate =</span> <span class="fl">0.007</span>, <span class="dt">transmission =</span> <span class="dv">1</span>, <span class="dt">numalleles =</span> <span class="dv">3</span>, 
                                  <span class="dt">allelesize =</span> <span class="dv">75</span>) <span class="op">%&gt;%</span>
<span class="st">                                </span><span class="kw">landscape.new.individuals</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">500</span>,<span class="dv">500</span>),<span class="dv">3</span>))
    }</code></pre></div>
<p>Now this function is used in the experiment described above. We are choosing 30 individuals from each population to analyze for phiST (see the landscape.sample function calls below)</p>
<p>The next two chunks are not run in the default package but should be able to run on any rmetasim installation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rland &lt;-<span class="st"> </span><span class="kw">create.land</span>()
retval &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">ncol=</span><span class="dv">4</span>,<span class="dt">nrow=</span><span class="dv">11</span>) <span class="co">#store the results col1 = gen, cols2-3 PhiST</span>
retval[<span class="dv">1</span>,] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">landscape.amova</span>(<span class="kw">landscape.sample</span>(rland,<span class="dt">ns=</span><span class="dv">30</span>))) <span class="co">#before any evolution occurs. Both populations from same source</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="dv">11</span>)
    {
        rland &lt;-<span class="st"> </span><span class="kw">landscape.simulate</span>(rland,<span class="dv">10</span>)
        retval[i,] &lt;-<span class="st"> </span><span class="kw">c</span>(rland<span class="op">$</span>intparam<span class="op">$</span>currentgen,<span class="kw">landscape.amova</span>(<span class="kw">landscape.sample</span>(rland,<span class="dt">ns=</span><span class="dv">30</span>))) 
    }
###the rest is just plotting the matrix of PhiSTs
###you can use any kind of graphics, of course.  using lattice here.
<span class="kw">colnames</span>(retval) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gen&quot;</span>,<span class="st">&quot;Loc1&quot;</span>,<span class="st">&quot;Loc2&quot;</span>,<span class="st">&quot;Loc3&quot;</span>)
<span class="kw">library</span>(lattice)
<span class="kw">xyplot</span>(Loc1<span class="op">+</span>Loc2<span class="op">+</span>Loc3<span class="op">~</span>gen, <span class="dt">data=</span><span class="kw">as.data.frame</span>(retval), <span class="dt">type=</span><span class="kw">c</span>(<span class="st">&quot;p&quot;</span>,<span class="st">&quot;smooth&quot;</span>),<span class="dt">auto.key=</span>T,<span class="dt">ylab=</span><span class="st">&quot;phiST&quot;</span>,<span class="dt">main=</span><span class="st">&quot;Change in phiST over time&quot;</span>)</code></pre></div>
<div id="replicating-this-experiment" class="section level3">
<h3>Replicating this “experiment”</h3>
<p>The graph in the previous section may be a little bit interesting. Does it hold up over multiple replicates? The following code replicates the previous experiment 3 times, a more useful number of replicates for understanding these time-series would be much higher (30? 100?). The data are then plotted like before.</p>
<p>The starting point is the same landscape creation function in the previous section.</p>
<p>Using lapply here is really useful because it parallelizes well using routines from the ``parallel’’ package (see mclapply).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">number.reps=<span class="dv">3</span>
retlst &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span>number.reps,<span class="cf">function</span>(x) 
                 {
                     rland &lt;-<span class="st"> </span><span class="kw">create.land</span>()
                     retval &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">ncol=</span><span class="dv">5</span>,<span class="dt">nrow=</span><span class="dv">11</span>) 
                     retval[<span class="dv">1</span>,] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">landscape.amova</span>(<span class="kw">landscape.sample</span>(rland,<span class="dt">ns=</span><span class="dv">30</span>)),x)
                     <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="dv">11</span>)
                         {
                             rland &lt;-<span class="st"> </span><span class="kw">landscape.simulate</span>(rland,<span class="dv">10</span>)
                             retval[i,] &lt;-<span class="st"> </span><span class="kw">c</span>(rland<span class="op">$</span>intparam<span class="op">$</span>currentgen,<span class="kw">landscape.amova</span>(<span class="kw">landscape.sample</span>(rland,<span class="dt">ns=</span><span class="dv">30</span>)),x) 
                         }
                     <span class="kw">colnames</span>(retval) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gen&quot;</span>,<span class="st">&quot;Loc1&quot;</span>,<span class="st">&quot;Loc2&quot;</span>,<span class="st">&quot;Loc3&quot;</span>,<span class="st">&quot;replicate&quot;</span>)
                     retval
                 })
retdf &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">do.call</span>(rbind,retlst))
mns =<span class="st"> </span><span class="kw">with</span>(retdf, <span class="kw">aggregate</span>(<span class="kw">cbind</span>(<span class="dt">Loc1=</span>Loc1,<span class="dt">Loc2=</span>Loc2,<span class="dt">Loc3=</span>Loc3),<span class="kw">list</span>(<span class="dt">gen=</span>gen),mean))
mns<span class="op">$</span>gen=<span class="kw">as.numeric</span>(mns<span class="op">$</span>gen)

<span class="kw">xyplot</span>(Loc1<span class="op">+</span>Loc2<span class="op">+</span>Loc3<span class="op">~</span>gen,<span class="dt">data=</span>mns,<span class="dt">auto.key=</span>T,<span class="dt">type=</span><span class="kw">c</span>(<span class="st">&quot;p&quot;</span>,<span class="st">&quot;smooth&quot;</span>),<span class="dt">ylab=</span><span class="st">&quot;phiST&quot;</span>,<span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;means of&quot;</span>,number.reps,<span class="st">&quot;replicates&quot;</span>))
<span class="kw">xyplot</span>(Loc1<span class="op">+</span>Loc2<span class="op">+</span>Loc3<span class="op">~</span>gen,<span class="dt">data=</span>retdf,<span class="dt">auto.key=</span>T,<span class="dt">type=</span><span class="kw">c</span>(<span class="st">&quot;p&quot;</span>,<span class="st">&quot;smooth&quot;</span>),<span class="dt">ylab=</span><span class="st">&quot;phiST&quot;</span>,<span class="dt">main=</span><span class="kw">paste</span>(number.reps,<span class="st">&quot;replicates for each locus&quot;</span>))</code></pre></div>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
