<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="A Strand" />

<meta name="date" content="2016-04-08" />

<title>Creating rmetasim landscapes</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%7D%0Apre%20%7B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div class="fluid-row" id="header">


<h1 class="title">Creating rmetasim landscapes</h1>
<h4 class="author"><em>A Strand</em></h4>
<h4 class="date"><em>2016-04-08</em></h4>

</div>


<div id="rmetasim-landscapes" class="section level1">
<h1>rmetasim landscapes</h1>
<p>The main data structure in rmetasim is the ‘landscape’. It contains all of the information necessary to specify a simulation rep and contains the exact state of the simulation at any point in time. The implication is that, once built, a landscape can undergo simulation for a period of time and then be:</p>
<ul>
<li>analyzed,</li>
<li>saved,</li>
<li>or even modified by the user</li>
</ul>
<p>before moving forward with additional simulation of that landscape.</p>
<div id="components-of-a-landscape" class="section level2">
<h2>Components of a landscape</h2>
<p>A landscape is just a ‘list()’ construct in R. Most of the objects contained in the list are themselves list objects.</p>
<p>It is possible to build one ‘by hand’ but rmetasim implements a set of convenience functions that make this process much less complicated.</p>
<p>The six main sections of the landscape:</p>
<ul>
<li><em>intparam</em> integer parameters describing landscape</li>
<li><em>switchparam</em> boolean switches turning features on and off</li>
<li><em>floatparam</em> floating point paramters</li>
<li><em>demography</em> lists describing the demography of the simulation (complex set of parameters)</li>
<li><em>loci</em> lists describing the genetic components of the simulation</li>
<li><em>individuals</em> a matrix that contains all individuals, their demographic states, ages and ids. It also contains the genetic information.</li>
</ul>
<p>The last three are values can change through the course of the simulation. Especially the last two.</p>
<div id="intparam" class="section level3">
<h3>intparam</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rmetasim)
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.empty</span>() <span class="co">#creates a skeleton of a landscape</span>
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.intparam</span>(rland, <span class="dt">h=</span><span class="dv">2</span>, <span class="dt">s=</span><span class="dv">2</span>) 

<span class="kw">names</span>(rland$intparam)</code></pre>
<pre><code>## [1] &quot;habitats&quot;     &quot;stages&quot;       &quot;locusnum&quot;     &quot;numepochs&quot;   
## [5] &quot;currentgen&quot;   &quot;currentepoch&quot; &quot;totalgens&quot;    &quot;numdemos&quot;    
## [9] &quot;maxlandsize&quot;</code></pre>
<p>These values represent:</p>
<ul>
<li><em>habitats</em> the number of different habitats or subpopulations within the landscape</li>
<li><em>stages</em> the number of stages in the life cycle of the organism; also the size of the S, R, and M matricies for local demography</li>
<li><em>locusnum</em> the number of different loci currently implemented for the simulation</li>
<li><em>numepochs</em> the number of different migration scenerios to occur during the simulation</li>
<li><em>currentgen</em> the current generation the simulation has reached</li>
<li><em>currentepoch</em> the current epoch the simulation has reached</li>
<li><em>totoalgens</em> the total number of generations to simulate</li>
<li><em>numdemos</em> the number of within population demographies</li>
<li><em>maxlandsize</em> the maxium number of individuals that can exist in the simulation</li>
</ul>
</div>
<div id="switchparam" class="section level3">
<h3>switchparam</h3>
<pre class="sourceCode r"><code class="sourceCode r">rland &lt;-<span class="st"> </span><span class="kw">landscape.new.switchparam</span>(rland)
<span class="kw">names</span>(rland$switchparam)</code></pre>
<pre><code>## [1] &quot;randepoch&quot;   &quot;randdemo&quot;    &quot;multp&quot;       &quot;densdepdemo&quot;</code></pre>
<p>These values represent:</p>
<ul>
<li><em>randepoch</em> 1=choose the next epoch randomly using their individual probabilities, 0=choose the next epoch according to their ordering</li>
<li><em>randdemo</em> 1=assign demographies at random, 0=assign demographies in order</li>
<li><em>multp</em> 1=multiple paternity, 0=entire families from a single mating</li>
<li><em>densdepdemo</em> a flag to turn density dependent population regulation on and off</li>
</ul>
</div>
<div id="floatparam" class="section level3">
<h3>floatparam</h3>
<pre class="sourceCode r"><code class="sourceCode r">rland &lt;-<span class="st"> </span><span class="kw">landscape.new.floatparam</span>(rland)
<span class="kw">names</span>(rland$floatparam)</code></pre>
<pre><code>## [1] &quot;selfing&quot;</code></pre>
<ul>
<li><em>selfing</em> This value is the selfing rate of the species (between 0 and 1 inclusive) assuming a mixed mating model where selfing occurs S proportion of the time and random mating occurs (1-S) proportion of the time.</li>
</ul>
</div>
<div id="demography" class="section level3">
<h3>demography</h3>
<pre class="sourceCode r"><code class="sourceCode r">S &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)
R &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)
M &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.local.demo</span>(rland,S,R,M)

S &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>),
              <span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>),
              <span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>),
              <span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>)), <span class="dt">nrow =</span> <span class="dv">4</span>)

R &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,
              <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,
              <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,
              <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">byrow=</span>T, <span class="dt">nrow =</span> <span class="dv">4</span>)

M &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,
              <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">1</span>,
              <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,
              <span class="dv">0</span>,.<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">nrow =</span> <span class="dv">4</span>)

rland &lt;-<span class="st"> </span><span class="kw">landscape.new.epoch</span>(rland,<span class="dt">S=</span>S,<span class="dt">R=</span>R,<span class="dt">M=</span>M,<span class="dt">extinct=</span><span class="kw">c</span>(.<span class="dv">01</span>,<span class="dv">0</span>),<span class="dt">carry=</span><span class="kw">c</span>(<span class="dv">100</span>,<span class="dv">200</span>))

<span class="kw">names</span>(rland$demography)</code></pre>
<pre><code>## [1] &quot;localdem&quot;  &quot;localdemK&quot; &quot;epochs&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(rland$demography$localdem[[<span class="dv">1</span>]])</code></pre>
<pre><code>## [1] &quot;LocalS&quot; &quot;LocalR&quot; &quot;LocalM&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(rland$demography$localdemK[[<span class="dv">1</span>]])</code></pre>
<pre><code>## NULL</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(rland$demography$epochs[[<span class="dv">1</span>]])</code></pre>
<pre><code>## [1] &quot;RndChooseProb&quot; &quot;StartGen&quot;      &quot;Extinct&quot;       &quot;Carry&quot;        
## [5] &quot;Localprob&quot;     &quot;S&quot;             &quot;R&quot;             &quot;M&quot;</code></pre>
<p>These are the local S, R, and M matricies for each subpopulation (localdem) and the S, R, and M matrices for the interpopulation movement of individuals (epochs). Notice the subscripts [[1]] after the localdem and epochs. Both localdem and epochs are lists of individual local demographies and epochs respectively. Since both localdem and epochs are lists the subscripts are necessary to view the contents of a single local demography or epoch.</p>
<p><em>localdem</em></p>
<p>LocalS, LocalR, LocalM: the S, R, and M matricies for a particular local demography during exponential growth. This is the only local demography used if density dependence is turned off.</p>
<p><em>localdemK</em></p>
<p>LocalS, LocalR, LocalM: the S, R, and M matricies for a particular local demography when at the carrying capacity. Individal demgraphic rates are linearly interpolated between localdem and localdemK based on how close the population size is to carrying capacity.</p>
<p><em>epochs</em></p>
<ul>
<li><em>RndChooseProb</em> the probability of randomly choosing this epoch if rland$switchparam$randepoch==1</li>
<li><em>StartGen</em> the generation this epoch begins if rland$switchparam$randepoch==0</li>
<li><em>Extinct</em> a vector of values given the extinction probability for each subpopulation</li>
<li><em>Carry</em> a vector of values denoting the maximum individuals for each subpopulation</li>
<li><em>Localprob</em> a list of probabilities for choosing local demographies if rland$switchparam$randedemo==1</li>
<li><em>S,R,M</em> The S, R, and M matricies for intersubpopulation movement</li>
</ul>
<p><em>loci</em></p>
<pre class="sourceCode r"><code class="sourceCode r">rland &lt;-<span class="st"> </span><span class="kw">landscape.new.locus</span>(rland,<span class="dt">type=</span><span class="dv">0</span>,<span class="dt">ploidy=</span><span class="dv">2</span>,<span class="dt">mutationrate=</span><span class="fl">0.001</span>,
                   <span class="dt">transmission=</span><span class="dv">0</span>,<span class="dt">numalleles=</span><span class="dv">5</span>)
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.locus</span>(rland,<span class="dt">type=</span><span class="dv">1</span>,<span class="dt">ploidy=</span><span class="dv">1</span>,<span class="dt">mutationrate=</span><span class="fl">0.005</span>,
                   <span class="dt">numalleles=</span><span class="dv">3</span>,<span class="dt">frequencies=</span><span class="kw">c</span>(.<span class="dv">2</span>,.<span class="dv">2</span>,.<span class="dv">6</span>))
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.locus</span>(rland,<span class="dt">type=</span><span class="dv">2</span>,<span class="dt">ploidy=</span><span class="dv">2</span>,<span class="dt">mutationrate=</span><span class="fl">0.007</span>,
                   <span class="dt">transmission=</span><span class="dv">0</span>,<span class="dt">numalleles=</span><span class="dv">6</span>,<span class="dt">allelesize=</span><span class="dv">75</span>)


<span class="kw">names</span>(rland$loci[[<span class="dv">1</span>]])</code></pre>
<pre><code>## [1] &quot;type&quot;    &quot;ploidy&quot;  &quot;trans&quot;   &quot;rate&quot;    &quot;alleles&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(rland$loci[[<span class="dv">1</span>]]$alleles[[<span class="dv">1</span>]])</code></pre>
<pre><code>## [1] &quot;aindex&quot; &quot;birth&quot;  &quot;prop&quot;   &quot;state&quot;</code></pre>
<p>Both loci and alleles are lists with elements of the structure shown above.</p>
<ul>
<li><p><strong>locus</strong></p>
<ul>
<li><em>type</em> The three allele types are 0=Infinite Allele mutation model/Integer state, 1=Strict stepwise mutation model/Integer state, 2=DNA base substitution/variable length sequence state.</li>
<li><em>ploidy</em> This can be 1 for haploid and 2 for diploid.</li>
<li><em>trans</em> The mode of inheritance. This can be 0 for bi-parental and 1 for maternal.</li>
<li><em>rate</em> The per allele (as opposed to per site) mutation rate (range [0 1])</li>
<li><em>alleles</em> list of alleles</li>
</ul></li>
<li><p><strong>allele</strong></p>
<ul>
<li><em>aindex</em> index number of the allele</li>
<li><em>birth</em> the generation the allele first appeared</li>
<li><em>prop</em> frequency of this allele</li>
<li><em>state</em> an integer for loci type 0 or 1, a string representing sequence of DNA for loci type 2 (only the characters A,T,C,G are allowed)</li>
</ul></li>
</ul>
<div id="individuals" class="section level4">
<h4>individuals</h4>
<p>The last major section is individuals. The structure is merely a large matrix with one individual per row. An example row may look like:</p>
<pre class="sourceCode r"><code class="sourceCode r">rland &lt;-<span class="st"> </span><span class="kw">landscape.new.individuals</span>(rland,<span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">8</span>))
<span class="kw">print</span>(rland$individuals[<span class="dv">1</span>,])</code></pre>
<pre><code>##  [1] 0 0 0 1 0 0 4 1 3 6 6</code></pre>
<p>A (static) example of an individual record with 3 loci (last one haploid) looks like this:.</p>
<p>stage notused birthdate ID matID patID loc1a1 loc1a2 loc2a1 loc2a2 loc3a1</p>
<p>The first six columns are always present and the last five shown here are a product of the choice of number of loci. The first column contains the individuals subpopulation and lifecycle stage (subpopulation = floor(x/rland$intparam$stages), lifecycle stage = x mod rland$intparam$stages). The second column is currently unused, always 0. The third column contains the generation in which the individual was born or created. The next three contain numerical ids for the individual, its mother and its father. After the first six columns the indivduals genetic code begins. The loci are shown in order with 2 columns for diploid loci and 1 column for haploid loci. The value of these columns represent the allele index of the allele the individual carries.</p>
</div>
</div>
</div>
<div id="creating-a-landscape" class="section level2">
<h2>Creating a landscape</h2>
<p>The section above introduces the different helper functions that can be used to create landscapes. Help for any of them can be obtained in the classic R fashion: ?landscape.new.intparams will provide help for the intparam constructor. Typing landscape.new.example without the parentheses will show the code for producing an entire landscape.</p>
<p>Here’s a complete example of building a landscape with two populations and two stages in each population</p>
<pre class="sourceCode r"><code class="sourceCode r">rland &lt;-<span class="st"> </span><span class="kw">landscape.new.empty</span>()
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.intparam</span>(rland, <span class="dt">h =</span> <span class="dv">2</span>, <span class="dt">s =</span> <span class="dv">2</span>)
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.switchparam</span>(rland, <span class="dt">mp =</span> <span class="dv">0</span>)
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.floatparam</span>(rland)

S &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)
R &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)
M &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)

rland &lt;-<span class="st"> </span><span class="kw">landscape.new.local.demo</span>(rland, S, R, M)

S &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">16</span>), <span class="dt">nrow =</span> <span class="dv">4</span>)
R &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">16</span>), <span class="dt">nrow =</span> <span class="dv">4</span>)
M &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">16</span>), <span class="dt">nrow =</span> <span class="dv">4</span>)

rland &lt;-<span class="st"> </span><span class="kw">landscape.new.epoch</span>(rland, <span class="dt">S =</span> S, <span class="dt">R =</span> R, <span class="dt">M =</span> M, 
                             <span class="dt">carry =</span> <span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>))

rland &lt;-<span class="st"> </span><span class="kw">landscape.new.locus</span>(rland, <span class="dt">type =</span> <span class="dv">0</span>, <span class="dt">ploidy =</span> <span class="dv">2</span>, 
                             <span class="dt">mutationrate =</span> <span class="fl">0.001</span>, <span class="dt">transmission =</span> <span class="dv">0</span>, <span class="dt">numalleles =</span> <span class="dv">5</span>)
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.locus</span>(rland, <span class="dt">type =</span> <span class="dv">1</span>, <span class="dt">ploidy =</span> <span class="dv">1</span>, 
                             <span class="dt">mutationrate =</span> <span class="fl">0.005</span>, <span class="dt">numalleles =</span> <span class="dv">3</span>, <span class="dt">frequencies =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, 
                                                                       <span class="fl">0.2</span>, <span class="fl">0.6</span>))
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.locus</span>(rland, <span class="dt">type =</span> <span class="dv">2</span>, <span class="dt">ploidy =</span> <span class="dv">2</span>, 
                             <span class="dt">mutationrate =</span> <span class="fl">0.007</span>, <span class="dt">transmission =</span> <span class="dv">0</span>, <span class="dt">numalleles =</span> <span class="dv">6</span>, 
                             <span class="dt">allelesize =</span> <span class="dv">75</span>)
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.individuals</span>(rland, <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">0</span>))</code></pre>
<div id="using-not-pipes-with-magrittr" class="section level3">
<h3>using (not) pipes with magrittr</h3>
<p>The magrittr package implements a way to pipe results from one function to another. This is used extensively in dplyr, for example. Since v3.0.0 of rmetasim, you can use pipes to create landscapes (and act on them as well). Here is the same code above using magrittr instead</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(magrittr)
<span class="co">#first set up the matrices for local demographies</span>
S &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)
R &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)
M &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)

<span class="co">#and epochs </span>
S.epoch &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">16</span>), <span class="dt">nrow =</span> <span class="dv">4</span>)
R.epoch &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">16</span>), <span class="dt">nrow =</span> <span class="dv">4</span>)
M.epoch &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">16</span>), <span class="dt">nrow =</span> <span class="dv">4</span>)

##now create the landscape
rland &lt;-<span class="st"> </span><span class="kw">landscape.new.empty</span>() %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">landscape.new.intparam</span>(<span class="dt">h=</span><span class="dv">2</span>,<span class="dt">s=</span><span class="dv">2</span>) %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">landscape.new.switchparam</span>(<span class="dt">mp=</span><span class="dv">0</span>) %&gt;%
<span class="st">    </span><span class="kw">landscape.new.floatparam</span>() %&gt;%
<span class="st">    </span><span class="kw">landscape.new.local.demo</span>( S, R, M) %&gt;%
<span class="st">    </span><span class="kw">landscape.new.epoch</span>(<span class="dt">S =</span> S.epoch, <span class="dt">R =</span> R.epoch, <span class="dt">M =</span> M.epoch, 
                        <span class="dt">carry =</span> <span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>)) %&gt;%
<span class="st">    </span><span class="kw">landscape.new.locus</span>(<span class="dt">type =</span> <span class="dv">0</span>, <span class="dt">ploidy =</span> <span class="dv">2</span>, 
                        <span class="dt">mutationrate =</span> <span class="fl">0.001</span>, <span class="dt">transmission =</span> <span class="dv">0</span>, <span class="dt">numalleles =</span> <span class="dv">5</span>) %&gt;%
<span class="st">    </span><span class="kw">landscape.new.locus</span>(<span class="dt">type =</span> <span class="dv">1</span>, <span class="dt">ploidy =</span> <span class="dv">1</span>, 
                        <span class="dt">mutationrate =</span> <span class="fl">0.005</span>, <span class="dt">numalleles =</span> <span class="dv">3</span>, <span class="dt">frequencies =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, 
                                                                  <span class="fl">0.2</span>, <span class="fl">0.6</span>)) %&gt;%
<span class="st">    </span><span class="kw">landscape.new.locus</span>(<span class="dt">type =</span> <span class="dv">2</span>, <span class="dt">ploidy =</span> <span class="dv">2</span>, 
                        <span class="dt">mutationrate =</span> <span class="fl">0.007</span>, <span class="dt">transmission =</span> <span class="dv">0</span>, <span class="dt">numalleles =</span> <span class="dv">6</span>, 
                        <span class="dt">allelesize =</span> <span class="dv">75</span>) %&gt;%
<span class="st">    </span><span class="kw">landscape.new.individuals</span>(<span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">0</span>))</code></pre>
</div>
</div>
</div>
<div id="run-a-simulation" class="section level1">
<h1>Run a simulation</h1>
<p>You can then use the landscape created in the previous section in a simulation. The easiest approach is to use landscape.simulate(). Here is the result of simulating for 10 time points (usually thought of as years) and then estimating Phi_ST for each locus.</p>
<pre class="sourceCode r"><code class="sourceCode r">rland &lt;-<span class="st"> </span><span class="kw">landscape.simulate</span>(rland,<span class="dv">10</span>)
<span class="kw">landscape.amova</span>(rland)</code></pre>
<pre><code>##        Phi        Phi        Phi 
## 0.01048001 0.08954402 0.12525014</code></pre>
<div id="with-not-pipes" class="section level2">
<h2>With (not) pipes…</h2>
<p>Here is the same analysis as the previous section.</p>
<pre class="sourceCode r"><code class="sourceCode r">rland %&gt;%<span class="st"> </span><span class="kw">landscape.simulate</span>(<span class="dv">10</span>) %&gt;%<span class="st"> </span><span class="kw">landscape.amova</span>()</code></pre>
<pre><code>##        Phi        Phi        Phi 
## 0.04785936 0.03661035 0.13367755</code></pre>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
